<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Motorista</title>
    <link rel="stylesheet" href="sportMode.css">
    <link rel="stylesheet" href="sportMode.js">

</head>
<header>
    <div class="modo">
        <input class="tgl tgl-ios" id="cb2" type="checkbox" onclick="verifyCheckbox()" checked />
        <label class="tgl-btn" for="cb2"></label>
        <h2>Modo sport</h2>
    </div>
    <div class="logo">
        <img src="../../../../assets/img/tesla_logo_icon_181279.png" alt="" width="50px">
    </div>
    <div class="hora">
        <span id="hora" class="hora"></span>
    </div>
</header>

<body onload="horario() , exibirBateria() , initBattery()">
    <div class="divTotal">
        <div class="divEsquerda">
            Telemetria:
            <div class="divResumo">
                <img src="../../../../assets/img/eixoTelemetria.png" alt="" class="imgResumo">
                Baixo
                <img src="../../../../assets/img/freioTelemetria.png" alt="" class="imgResumo">
                Alto
                <img src="../../../../assets/img/pneuTelemetria.png" alt="" class="imgResumo">
                Médio
            </div>
            <div class="divTeslaTelemetria">
                <div class="divDianteira">
                    <div class="divRodaDianteiraEsquerda">
                        <div class="divSup">
                            155°C<img src="../../../../assets/img/eixoTelemetria.png" alt=""
                                class="imgTelemetriaComponente">
                        </div>
                        <div class="divSup">
                            155°C<img src="../../../../assets/img/freioTelemetria.png" alt=""
                                class="imgTelemetriaComponente">
                        </div>
                        <div class="divSup">
                            155°C<img src="../../../../assets/img/pneuTelemetria.png" alt=""
                                class="imgTelemetriaComponente">
                        </div>
                    </div>
                    <div class="divRodaDianteiraDireita">
                        <div class="divSup">
                            <img src="../../../../assets/img/eixoTelemetria.png" alt=""
                                class="imgTelemetriaComponente">155°C
                        </div>
                        <div class="divSup">
                            <img src="../../../../assets/img/freioTelemetria.png" alt=""
                                class="imgTelemetriaComponente">155°C
                        </div>
                        <div class="divSup">
                            <img src="../../../../assets/img/pneuTelemetria.png" alt=""
                                class="imgTelemetriaComponente">155°C
                        </div>
                    </div>
                </div>
                <div class="divTraseira">
                    <div class="divRodaTraseiraEsquerda">
                        <div class="divSup">
                            155°C <img src="../../../../assets/img/eixoTelemetria.png" alt=""
                                class="imgTelemetriaComponente">
                        </div>
                        <div class="divSup">
                            155°C <img src="../../../../assets/img/freioTelemetria.png" alt=""
                                class="imgTelemetriaComponente">
                        </div>
                        <div class="divSup">
                            155°C <img src="../../../../assets/img/pneuTelemetria.png" alt=""
                                class="imgTelemetriaComponente">
                        </div>
                    </div>
                    <div class="divRodaTraseiraDireita">
                        <div class="divSup">
                            <img src="../../../../assets/img/eixoTelemetria.png" alt=""
                                class="imgTelemetriaComponente">155°C
                        </div>
                        <div class="divSup">
                            <img src="../../../../assets/img/freioTelemetria.png" alt=""
                                class="imgTelemetriaComponente">155°C
                        </div>
                        <div class="divSup">
                            <img src="../../../../assets/img/pneuTelemetria.png" alt=""
                                class="imgTelemetriaComponente">155°C
                        </div>
                    </div>
                </div>
            </div>
            <div class="divLegenda">
                <img src="../../../../assets/img/eixoTelemetria.png" alt="" class="imgResumo">
                Eixo
                <img src="../../../../assets/img/freioTelemetria.png" alt="" class="imgResumo">
                Freio
                <img src="../../../../assets/img/pneuTelemetria.png" alt="" class="imgResumo">
                Pneu
            </div>
        </div>
        <div class="divDireita">
            <div class="divSuperior">
                <div class="divKpi">
                    Autonomia da bateria: <br>
                    2 h 34 min <br><br>
                    Média de gasto:(Mhz) <br>
                    XXXXXX
                </div>
                <div class="bateria">
                    <div class="battery__card">
                        <div class="battery__data">
                            <p class="battery__text">Bateria</p>
                            <h1 id="batteryPercentage" class="battery__percentage">
                                20%
                            </h1>

                            <p class="battery__status">
                                Bateria Baixa <i class="ri-plug-line"></i>
                            </p>
                        </div>

                        <div class="battery__pill">
                            <div class="battery__level">
                                <div class="battery__liquid"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="divKpi">
                    Lap <br><br>
                    Volta: 2:34:31 Votla<br> <br>
                    Ultima volta: 2:34:31 <br>
                    Melhor volta: 2:34:31 <br><br>
                    Sessão: 30:21:32 <br><br>
                    Finalizar
                </div>
            </div>
            <div class="divInferior">
                <div class="chart">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
        </div>
</body>

</html>

<script src="tela.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>


    const ctx = document.getElementById('myChart');
    const data = [];
    let prev = 100;
    for (let i = 0; i < 1000; i++) {
        prev += 5 - Math.random() * 10;
        data.push({ x: i, y: prev });
    }

    const totalDuration = 10000;
    const delayBetweenPoints = totalDuration / data.length;
    const previousY = (ctx) => ctx.index === 0 ? ctx.chart.scales.y.getPixelForValue(100) : ctx.chart.getDatasetMeta(ctx.datasetIndex).data[ctx.index - 1].getProps(['y'], true).y;
    const animation = {
        x: {
            type: 'number',
            easing: 'linear',
            duration: delayBetweenPoints,
            from: NaN, // the point is initially skipped
            delay(ctx) {
                if (ctx.type !== 'data' || ctx.xStarted) {
                    return 0;
                }
                ctx.xStarted = true;
                return ctx.index * delayBetweenPoints;
            }
        },
        y: {
            type: 'number',
            easing: 'linear',
            duration: delayBetweenPoints,
            from: previousY,
            delay(ctx) {
                if (ctx.type !== 'data' || ctx.yStarted) {
                    return 0;
                }
                ctx.yStarted = true;
                return ctx.index * delayBetweenPoints;
            }
        }
    };

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
                label: '# of Votes',
                data: data,
                borderWidth: 1,
                borderColor: "rgb(255, 0, 0)",
                radius: 0,
            }]
        },
        options: {
            animation,
            interaction: {
                intersect: false
            },
            plugins: {
                legend: false
            },
            scales: {
                x: {
                    type: 'linear',
                }
            }
        }

    });


    function horario() {

        var tempo = new Date();

        document.getElementById("hora").innerHTML = `${tempo.getHours()}:${tempo.getMinutes()}`;

        if (tempo.getMinutes() < 10) {
            document.getElementById("hora").innerHTML = `${tempo.getHours()}:0${tempo.getMinutes()}`;
        }
    }
    setInterval(horario, 10000)


    var arrayTablet = [];

    function exibirBateria() {
        fetch(`/tablet/exibirBateria`)
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        arrayTablet = resposta;

                        batteryPercentage = arrayTablet[0].bateriaNivel.toString().slice(0, 3)
                        initBattery(batteryPercentage)

                    });
                } else {
                    console.error("Nenhum dado encontrado ou erro na API");
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ idEmpresa: ${error.message}`);
            });
        return false;
    }

    function initBattery() {
        const batteryLiquid = document.querySelector('.battery__liquid'),
            batteryStatus = document.querySelector('.battery__status'),
            batteryHTML = document.querySelector('#batteryPercentage')

        let level = Math.floor(batteryPercentage)
        batteryHTML.innerHTML = level + '%'

        batteryLiquid.style.height = `${parseInt(batteryPercentage)}%`

        if (batteryPercentage == 100) {
            batteryStatus.innerHTML = `Full batterry <i class="ri-battery-2-fill green-color"></i>`
            batteryLiquid.style.height = '103%'
            batteryStatus.style.margin = '35px'
        }
        else if (batteryPercentage <= 20 & !batteryPercentage.charging) {
            batteryStatus.innerHTML = `Low battery <i class="ri-plug-line animated-red"></i>`
            batteryStatus.style.margin = '35px'
        }
        else if (batteryPercentage.charging) {
            batteryStatus.innerHTML = `Charging... <i class="ri-flashlight-line animated-green"></i>`
            batteryStatus.style.margin = '35px'
        }
        else {
            batteryStatus.innerHTML = ''
        }

        if (batteryPercentage <= 20) {
            batteryLiquid.classList.add('gradient-color-red')
            batteryLiquid.classList.remove('gradient-color-orange', 'gradient-color-yellow', 'gradient-color-green')
        }
        else if (batteryPercentage <= 40) {
            batteryLiquid.classList.add('gradient-color-orange')
            batteryLiquid.classList.remove('gradient-color-red', 'gradient-color-yellow', 'gradient-color-green')
        }
        else if (batteryPercentage <= 80) {
            batteryLiquid.classList.add('gradient-color-yellow')
            batteryLiquid.classList.remove('gradient-color-red', 'gradient-color-orange', 'gradient-color-green')
        }
        else {
            batteryLiquid.classList.add('gradient-color-green')
            batteryLiquid.classList.remove('gradient-color-red', 'gradient-color-orange', 'gradient-color-yellow')
        }
    }

    function verifyCheckbox() {
        if (cb2.checked) {
            window.location.href = "../dash-sportMode/sportMode.html";
        } else {
            window.location.href = "../dash-motorista/tela_nova.html";
        }
    }


</script>